var home_Path=document.location.protocol+"//"+window.document.location.hostname+"/",userAgent=window.navigator.userAgent.toLowerCase();console.log(userAgent);for(var norunAI=["android","iphone","ipod","ipad","windows phone","mqqbrowser","msie","trident/7.0"],norunFlag=!1,i=0;i<norunAI.length;i++)if(userAgent.indexOf(norunAI[i])>-1){norunFlag=!0;break}if(window.WebGLRenderingContext||(norunFlag=!0),!norunFlag){var hitFlag=!1,AIFadeFlag=!1,liveTlakTimer=null,sleepTimer_=null,AITalkFlag=!1,talkNum=0;function showHitokoto(){"1"!==sessionStorage.getItem("Sleepy")?AITalkFlag||$.getJSON("https://sslapi.hitokoto.cn/",(function(e){talkValTimer(),showMessage(e.hitokoto,0)})):(hideMessage(0),null==sleepTimer_&&(sleepTimer_=setInterval((function(){checkSleep()}),200)),console.log(sleepTimer_))}function checkSleep(){"1"!==sessionStorage.getItem("Sleepy")&&(talkValTimer(),showMessage("你回来啦~",0),clearInterval(sleepTimer_),sleepTimer_=null)}function showMessage(e,t){Array.isArray(e)&&(e=e[Math.floor(Math.random()*e.length+1)-1]),$(".message").stop(),$(".message").html(e),$(".message").fadeTo(200,1)}function talkValTimer(){$("#live_talk").val("1")}function hideMessage(e){null===e&&(e=5e3),$(".message").delay(e).fadeTo(200,0)}function initLive2d(){$("#hideButton").on("click",(function(){if(AIFadeFlag)return!1;AIFadeFlag=!0,localStorage.setItem("live2dhidden","0"),$("#landlord").fadeOut(200),$("#open_live2d").delay(200).fadeIn(200),setTimeout((function(){AIFadeFlag=!1}),300)})),$("#open_live2d").on("click",(function(){if(AIFadeFlag)return!1;AIFadeFlag=!0,localStorage.setItem("live2dhidden","1"),$("#open_live2d").fadeOut(200),$("#landlord").delay(200).fadeIn(200),setTimeout((function(){AIFadeFlag=!1}),300)})),$("#youduButton").on("click",(function(){if($("#youduButton").hasClass("doudong")){var e=$("#youduButton").attr("data-type");$("#youduButton").removeClass("doudong"),$("body").removeClass(e),$("#youduButton").attr("data-type","")}else{var t=$("#duType").val().split(","),o=t[Math.floor(Math.random()*t.length)];$("#youduButton").addClass("doudong"),$("#youduButton").attr("data-type",o),$("body").addClass(o)}}));var e=["model/Sakurasou/mashiro/seifuku.model.json","model/Sakurasou/mashiro/shifuku.model.json","model/Sakurasou/mashiro/ryoufuku.model.json"],t=0,o=localStorage.getItem("live2dfuku");null!==o&&(t=parseInt(o)),$("#huanzhuangButton").on("click",(function(){++t>=e.length&&(t=0),localStorage.setItem("live2dfuku",t),loadlive2d("live2d",message_Path+e[t])})),""!==talkAPI?($("#showInfoBtn").on("click",(function(){"0"!=$("#live_statu_val").val()&&($("#live_statu_val").val("0"),$(".live_talk_input_body").fadeOut(500),AITalkFlag=!1,showHitokoto(),$("#showTalkBtn").show(),$("#showInfoBtn").hide())})),$("#showTalkBtn").on("click",(function(){"1"!=$("#live_statu_val").val()&&($("#live_statu_val").val("1"),$(".live_talk_input_body").fadeIn(500),AITalkFlag=!0,$("#showTalkBtn").hide(),$("#showInfoBtn").show())})),$("#talk_send").on("click",(function(){var e=$("#AIuserText").val(),t=$("#AIuserName").val();""!=e?""!=t?(showMessage("思考中~",0),$.ajax({type:"POST",url:talkAPI,data:{info:e,userid:t},success:function(e){1e5!==e.code?(talkValTimer(),showMessage("似乎有什么错误，请和站长联系！",0)):(talkValTimer(),showMessage(e.text,0)),console.log(e),$("#AIuserText").val(""),sessionStorage.setItem("live2duser",t)}})):showMessage("聊之前请告诉我你的名字吧！",0):showMessage("写点什么吧！",0)}))):($("#showInfoBtn").hide(),$("#showTalkBtn").hide());var a=$("input[name=live2dBGM]");if(0==a.length)$("#musicButton").hide();else{var s=parseInt($("#live2d_bgm").attr("data-bgm")),n=0,l=sessionStorage.getItem("live2dBGM_Num"),i=sessionStorage.getItem("live2dBGM_PlayTime");l&&l<=$("input[name=live2dBGM]").length-1&&(s=parseInt(l)),i&&(n=parseInt(i));var r=a.eq(s).val();$("#live2d_bgm").attr("data-bgm",s),$("#live2d_bgm").attr("src",r),$("#live2d_bgm")[0].currentTime=n,$("#live2d_bgm")[0].volume=.5;var u=sessionStorage.getItem("live2dBGM_IsPlay"),d=sessionStorage.getItem("live2dBGM_WindowClose");"0"==u&&"0"==d&&($("#live2d_bgm")[0].play(),$("#musicButton").addClass("play")),sessionStorage.setItem("live2dBGM_WindowClose","1"),$("#musicButton").on("click",(function(){$("#musicButton").hasClass("play")?($("#live2d_bgm")[0].pause(),$("#musicButton").removeClass("play"),sessionStorage.setItem("live2dBGM_IsPlay","1")):($("#live2d_bgm")[0].play(),$("#musicButton").addClass("play"),sessionStorage.setItem("live2dBGM_IsPlay","0"))})),window.onbeforeunload=function(){sessionStorage.setItem("live2dBGM_WindowClose","0"),$("#musicButton").hasClass("play")&&sessionStorage.setItem("live2dBGM_IsPlay","0")},document.getElementById("live2d_bgm").addEventListener("timeupdate",(function(){var e=document.getElementById("live2d_bgm").currentTime;sessionStorage.setItem("live2dBGM_PlayTime",e)})),document.getElementById("live2d_bgm").addEventListener("ended",(function(){var e=parseInt($("#live2d_bgm").attr("data-bgm"));++e>$("input[name=live2dBGM]").length-1&&(e=0);var t=$("input[name=live2dBGM]").eq(e).val();sessionStorage.setItem("live2dBGM_Num",e),$("#live2d_bgm").attr("src",t),$("#live2d_bgm")[0].play(),$("#live2d_bgm").attr("data-bgm",e)})),document.getElementById("live2d_bgm").addEventListener("error",(function(){$("#live2d_bgm")[0].pause(),$("#musicButton").removeClass("play"),showMessage("音乐似乎加载不出来了呢！",0)}))}var m=sessionStorage.getItem("live2duser");null!==m&&$("#AIuserName").val(m);var c=sessionStorage.getItem("historywidth"),g=sessionStorage.getItem("historyheight");function h(){return window.event||arguments.callee.caller.arguments[0]}null!=c&&null!=g||(c="5px",g="0px"),$("#landlord").css("left",c+"px"),$("#landlord").css("bottom",g+"px");var v=document.getElementById("landlord"),f=0,p=0,_=!1,k=document.onmousemove,I=document.onmouseup;v.onmousedown=function(){var e=h();_=!0,f=e.clientX,e.clientY;var t=v;parseInt(t.style.bottom),p=parseInt(t.style.left),(isFirefox=navigator.userAgent.indexOf("Firefox")>0)&&window.getSelection().removeAllRanges(),document.onmousemove=function(){if(_){var e=h(),o=p+e.clientX-f;t.style.left=o+"px"}},document.onmouseup=function(){if(_){var e=t.style.left,o=t.style.bottom;e=e.replace("px",""),o=o.replace("px",""),sessionStorage.setItem("historywidth",e),sessionStorage.setItem("historyheight",o),document.onmousemove=k,document.onmouseup=I,_=!1,f=0,0,0,p=0}}}}!function(){String.prototype.renderTip=function(e){return function(e,t){return e.replace(/(\\)?\{([^\{\}\\]+)(\\)?\}/g,(function(e,o,a,s){if(o||s)return e.replace("\\","");var n,l,i=a.replace(/\s/g,"").split("."),r=t;for(n=0,l=i.length;n<l;++n)if(null==(r=r[i[n]]))return"";return r}))}(this,e)};var e;if($(document).on("copy",(function(){showMessage("你都复制了些什么呀，转载要记得加上出处哦~~",5e3)})),$.ajax({cache:!0,url:message_Path+"message.json",dataType:"json",success:function(e){$.each(e.mouseover,(function(e,t){$(t.selector).mouseover((function(){var e=t.text;Array.isArray(t.text)&&(e=t.text[Math.floor(Math.random()*t.text.length+1)-1]),showMessage(e=e.renderTip({text:$(this).text()}),3e3),talkValTimer(),clearInterval(liveTlakTimer),liveTlakTimer=null})),$(t.selector).mouseout((function(){showHitokoto(),null==liveTlakTimer&&(liveTlakTimer=window.setInterval((function(){showHitokoto()}),15e3))}))})),$.each(e.click,(function(e,t){$(t.selector).click((function(){if(hitFlag)return!1;hitFlag=!0,setTimeout((function(){hitFlag=!1}),8e3);var e=t.text;Array.isArray(t.text)&&(e=t.text[Math.floor(Math.random()*t.text.length+1)-1]),showMessage(e=e.renderTip({text:$(this).text()}),3e3)})),clearInterval(liveTlakTimer),null==(liveTlakTimer=null)&&(liveTlakTimer=window.setInterval((function(){showHitokoto()}),15e3))}))}}),""!==document.referrer){var t=document.createElement("a");t.href=document.referrer,e='嗨！来自 <span style="color:#0099cc;">'+t.hostname+"</span> 的朋友！";var o=t.hostname.split(".")[1];"baidu"==o?e='嗨！ 来自 百度搜索 的朋友！<br>欢迎访问<span style="color:#0099cc;">「 '+document.title.split(" - ")[0]+" 」</span>":"so"==o?e='嗨！ 来自 360搜索 的朋友！<br>欢迎访问<span style="color:#0099cc;">「 '+document.title.split(" - ")[0]+" 」</span>":"google"==o&&(e='嗨！ 来自 谷歌搜索 的朋友！<br>欢迎访问<span style="color:#0099cc;">「 '+document.title.split(" - ")[0]+" 」</span>")}else if(window.location.href==home_Path){var a=(new Date).getHours();e=a>23||a<=5?"你是夜猫子呀？这么晚还不睡觉，明天起的来嘛？":a>5&&a<=7?"早上好！一日之计在于晨，美好的一天就要开始了！":a>7&&a<=11?"上午好！工作顺利嘛，不要久坐，多起来走动走动哦！":a>11&&a<=14?"中午了，工作了一个上午，现在是午餐时间！":a>14&&a<=17?"午后很容易犯困呢，今天的运动目标完成了吗？":a>17&&a<=19?"傍晚了！窗外夕阳的景色很美丽呢，最美不过夕阳红~~":a>19&&a<=21?"晚上好，今天过得怎么样？":a>21&&a<=23?"已经这么晚了呀，早点休息吧，晚安~~":"嗨~ 快来逗我玩吧！"}else e='欢迎阅读<span style="color:#0099cc;">「 '+document.title.split(" - ")[0]+" 」</span>";showMessage(e,12e3)}(),liveTlakTimer=setInterval((function(){showHitokoto()}),15e3),$(document).ready((function(){var e=0,t=localStorage.getItem("live2dfuku");null!==t&&(e=parseInt(t));for(var o=[[home_Path+message_Path+"model/Sakurasou/mashiro/seifuku.1024/L2DMSR_U_00.png",home_Path+message_Path+"model/Sakurasou/mashiro/seifuku.1024/L2DMSR_U_01.png",home_Path+message_Path+"model/Sakurasou/mashiro/seifuku.1024/L2DMSR_U_02.png"],[home_Path+message_Path+"model/Sakurasou/mashiro/shifuku.1024/L2DMSR_S_00.png",home_Path+message_Path+"model/Sakurasou/mashiro/shifuku.1024/L2DMSR_S_01.png",home_Path+message_Path+"model/Sakurasou/mashiro/shifuku.1024/L2DMSR_S_02.png",home_Path+message_Path+"model/Sakurasou/mashiro/shifuku.1024/L2DMSR_S_03.png"],[home_Path+message_Path+"model/Sakurasou/mashiro/ryoufuku.1024/L2DMSR_R_00.png",home_Path+message_Path+"model/Sakurasou/mashiro/ryoufuku.1024/L2DMSR_R_01.png",home_Path+message_Path+"model/Sakurasou/mashiro/ryoufuku.1024/L2DMSR_R_02.png"]],a=["model/Sakurasou/mashiro/seifuku.model.json","model/Sakurasou/mashiro/shifuku.model.json","model/Sakurasou/mashiro/ryoufuku.model.json"],s=o[e],n=[],l=s.length,i=0,r=0;r<l;r++)n[r]=new Image,n[r].src=s[r],n[r].onload=function(){++i===l&&("0"===localStorage.getItem("live2dhidden")?setTimeout((function(){$("#open_live2d").fadeIn(200)}),1300):setTimeout((function(){$("#landlord").fadeIn(200)}),1300),setTimeout((function(){loadlive2d("live2d",message_Path+a[e])}),1e3),initLive2d(),n=null)}}))}